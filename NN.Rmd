---
title: "Churn analysis with neuralnet"
author: "Jackie Lu"
date: '2019-11-10'
header-includes:
  - \usepackage{latexsym,graphicx}
  - \usepackage{xcolor}
---
\definecolor{mylightgray}{RGB}{215, 215, 215}
\color{mylightgray}
\definecolor{mydarkgray}{RGB}{45, 45, 45}
\pagecolor{mydarkgray}
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Info:
```{r}
# Link to the article that informed this code
# https://www.datacamp.com/community/tutorials/neural-network-models-r
```

Example
```{r}
library(neuralnet)
library(dplyr)

# creating training data set
TKS1 = c(20, 10, 30, 20, 80, 30)
CSS1 = c(90, 20, 40, 50, 50, 80)
Placed1 = c(1, 0, 0, 0, 1, 1)

# Here, you will combine multiple columns or features into a single set of data
df1 = data.frame(TKS1, CSS1, Placed1)

# Fitting the neural network
nn1 <- neuralnet(Placed1 ~ TKS1 + CSS1, data = df1, hidden = 3, act.fct = "logistic", linear.output = F)

# Plotting the neural network
plot(nn1)

# Creating a test set
TKS1 = c(30, 40, 85)
CSS1 = c(85, 50, 40)
test1 <- data.frame(TKS1, CSS1)

# Predict 'Placed1'
Predict1 = neuralnet::compute(nn1, test1)
Predict1$net.result

# Converting probabilities into binary placed or not
prob1 <- Predict1$net.result
(pred1 <- ifelse(prob1 > 0.5, yes = 1, no = 0))
```

Trying neural networks with churn data
```{r}
# If not done already
# library(neuralnet)
# library(dplyr)
library(purrr)

# Load the data
cd1 <- read.csv(file = "Churn.csv", header = TRUE, sep = ",")

# Edit column names so that they are all lowercase
colnames(cd1) <- map(colnames(cd1), tolower)

# Function that makes a yes/no/something_else column, or 0/1 column into a
# logical column consisting of TRUE/FALSE
binarize <- function(cd1){
    for( i in c( 1:length(colnames(cd1)) ) ){
        print(i)
        if(
            (levels(factor( cd1[[ colnames(cd1)[i] ]] ))[1] == "0" |
             levels(factor( cd1[[ colnames(cd1)[i] ]] ))[2] == "0") &
            (levels(factor( cd1[[ colnames(cd1)[i] ]] ))[1] == "1" |
             levels(factor( cd1[[ colnames(cd1)[i] ]] ))[2] == "1")
        ){
            print(i)
            cd1[ , i] = as.logical(cd1[ , i])
        }
    }
}
for( i in c( 1:length(colnames(cd1)) ) ){
    # If column is has 0 and 1 as its levels
    if( (levels(factor( cd1[[ colnames(cd1)[i] ]] ))[1] == "0" |
         levels(factor(cd1[ , i]))[2] == "0") &
        (levels(factor(cd1[ , i]))[1] == "1" | 
         levels(factor(cd1[ , i]))[2] == "1") ){
        cd1[[ colnames(cd1)[i] ]] <- as.logical(cd1[[ colnames(cd1)[i] ]])
    }
    # If "Yes" and "No" are one of the levels, and if there are only 3 levels
    else if( length(levels(factor( cd1[[ colnames(cd1)[i] ]] )) ) < 4
    ){
        if( (levels(factor( cd1[[ colnames(cd1)[i] ]] ))[1] == "Yes" |
           levels(factor( cd1[[ colnames(cd1)[i] ]] ))[2] == "Yes" |
           levels(factor( cd1[[ colnames(cd1)[i] ]] ))[3] == "Yes") &
           (levels(factor( cd1[[ colnames(cd1)[i] ]] ))[1] == "No" |
           levels(factor( cd1[[ colnames(cd1)[i] ]] ))[2] == "No" |
           levels(factor( cd1[[ colnames(cd1)[i] ]] ))[3] == "No")
          ){
            cd1[[ colnames(cd1)[i] ]] <- ifelse(cd1[[ colnames(cd1)[i] ]] ==
                                                "Yes",
                                                yes = T,
                                                no = F)
        }
    }
}
    # Use this function cd1$seniorcitizen = as.logical(cd1$seniorcitizen)
    
    # If length(levels(factor(cd0$multiplelines))) < 3
    # and Yes is one of the levels, then use this
    # ifelse(cd1$dependents == "Yes", yes = T, no = F)

cd1$seniorcitizen = as.logical(cd1$seniorcitizen)
cd1$partner = as.logical(cd1$seniorcitizen)
cd1$dependents = ifelse(cd1$dependents == "Yes", yes = T, no = F)
cd1$phoneservice = ifelse(cd1$phoneservice == "Yes", yes = T, no = F)
cd1$multiplelines = ifelse(cd1$multiplelines == "Yes", yes = T, no = F)
cd1$onlinesecurity = ifelse(cd1$onlinesecurity == "Yes", yes = T, no = F)
cd1$onlinebackup = ifelse(cd1$onlinebackup == "Yes", yes = T, no = F)
cd1$deviceprotection = ifelse(cd1$deviceprotection == "Yes", yes = T, no = F)
cd1$techsupport = ifelse(cd1$techsupport == "Yes", yes = T, no = F)

```





