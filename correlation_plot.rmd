---
title: "Correlation plot"
author: "Paige, Vicky, and Jackie"
date: '2019-11-10'
output: 
  prettydoc::html_pretty:
  theme : cayman
  highlight : github
  math: katex
---

# Loading libraries
```{r}
library(ggplot2)
library(reshape2) # Used for the melt function
```

#load data

```{r}
library(dplyr)# Load the data
cd <- read.csv(file = "cleanData.csv", header = TRUE, sep = ",", 
                stringsAsFactors = T)

print("ORIGIN DATA")

summary(cd)
```

# Getting correlations
```{r}
# Method used to get 'correlation' for categorical variables
# https://datascience.stackexchange.com/questions/893/how-to-get-correlation-between-two-categorical-variable-and-a-categorical-variab#898

# All column types in cd are either factors (categorical), 
# or numerical (including integers)
unlist(lapply(cd, class))

# Calculate correlation for dataframe with categorical and numerical variables
categorical_cor <- function(column1, column2){
    if( class(column1) == "factor" &&
        (class(column2) == "numeric" || class(column2) == "integer")
    ){  # Swap the columns; I think this is having issues, I will just try
        # call the function again, but with swapped columns
        # temp_column = column1
        # column1 = column2
        # column2 = temp_column
        # rm(temp_column)
        categorical_cor(column2, column1)
    } # Columns should be numerical/integer, then factor
    # else if(column1 == column2){
    #     # Hard coding a correlation of 1 if both columns are the same
    #     return(1)
    # }
    else{
        if( # Use chi squared if class(column) == factor for both
            (class(column1) == "factor") &&
            (class(column2) == "factor")
        ){
            # Not sure if correct needs to be equal to F, 
            # but the link shows it
            return(chisq.test(column1, column2, correct = F)$p.value)
        }
        else if( # Use corr if class(column) == numerical or integer for both
            ( (class(column1) == "numeric") ||
            (class(column1) == "integer") ) &&
            ( (class(column2) == "numeric") ||
            (class(column2) == "integer") )
        ){
            cor(column1, column2)
        }
        else if( # Use the p-value from aov if the columns are a mix
            (class(column1) == "numeric" || class(column1) == "integer") &&
            class(column2) == "factor"
        ){
            summary_table <- summary(aov(column1 ~ column2))
            return(summary_table[[1]][[5]][1]) # This should return the p-value
        }
        else{ # Return this message if at least one of the columns
            # is a different class than factor, numerical or integer
            return("error, 
                   class(column) must be factor, numerical, or integer")
        }
    }
}

# Create an empty data frame to store all the correlation values
cd.cor <- cbind(expand.grid("Column 1" = colnames(cd), 
                            "Column 2" = colnames(cd)), "Corr" = 0)
# Add the correlation values
# Find a way to fill the "Corr" column with values from the custom function

```

# Create correlation plot matrix
```{r}
# Heatmap code from the link below
# http://www.sthda.com/english/wiki/ggplot2-quick-correlation-matrix-heatmap-r-software-and-data-visualization
ggplot(data = cd, aes = (x = ))

head(cd.cor$`Column 1`)

# Example of using the map function
df1 <- data.frame("Col_1" = c(1, 2, 3), "Col_2" = c(7, 8, 9))

map2(df1$Col_1,df1$Col_2, sum)

# For each row of cd.cor

# Use the function on two columns; the column names are obtained from
# the first two columns of cd.cor

for(i in c(1:529)){
    cd.cor[i, 3] <- categorical_cor(cd[[ cd.cor[i, 1] ]], 
                                    cd[[ cd.cor[i, 2] ]])
    
}

# https://en.wikipedia.org/wiki/Pearson%27s_chi-squared_test
# Pearson's chi-squared test (Ï‡2) is a statistical test applied to sets of 
# categorical data to evaluate how likely it is that any observed 
# difference between the sets arose by chance


```



